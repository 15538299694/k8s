(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{234:function(e,t,s){"use strict";s.r(t);var a=s(0),v=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"service资源管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service资源管理"}},[e._v("#")]),e._v(" Service资源管理")]),e._v(" "),s("ul",[s("li",[e._v("为什么需要Service资源?")]),e._v(" "),s("li",[e._v("Service资源如何管理Pod")]),e._v(" "),s("li",[e._v("Endpoints")])]),e._v(" "),s("h2",{attrs:{id:"_1-为什么需要service资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-为什么需要service资源"}},[e._v("#")]),e._v(" 1.为什么需要Service资源?")]),e._v(" "),s("p",[e._v("我们之前提到过一个控制器："),s("code",[e._v("deployment")]),e._v(",他会根据"),s("code",[e._v("rs")]),e._v("中定义的用户期望数量，去平衡现有状态和用户状态，也有自己的选择器，关联新增的"),s("code",[e._v("pod")]),e._v("资源。这两点听上去，貌似也解决了"),s("code",[e._v("pod")]),e._v("动态变更的问题，那我们为什么还需要引入"),s("code",[e._v("service")]),e._v("呢？\n")]),s("details",[s("summary",[e._v("点击打开答案/收起")]),e._v(" "),s("br"),e._v("\n其实，"),s("code",[e._v("service")]),e._v("的引入最重要的一点，就是给访问者提供一个固定访问入口的抽象层。客户端应该直接向"),s("code",[e._v("service")]),e._v("发起请求，而不是"),s("code",[e._v("pod")]),e._v("。\n")]),s("p"),e._v(" "),s("p",[s("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/Kubernetes/service.png",alt:"service"}})]),e._v(" "),s("h2",{attrs:{id:"_2-service资源如何管理pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-service资源如何管理pod"}},[e._v("#")]),e._v(" 2.Service资源如何管理Pod")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("service")]),e._v("通过标签选择器关联至拥有相关标签的"),s("code",[e._v("Pod")]),e._v("对象")]),e._v(" "),s("li",[e._v("客户端向"),s("code",[e._v("Service")]),e._v("进行请求，而非直接请求"),s("code",[e._v("Pod")]),e._v("对象")])]),e._v(" "),s("ol",[s("li",[s("code",[e._v("service")]),e._v("配置字段的查看命令")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("kubectl explain svc\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("code",[e._v("Service")]),e._v("默认类型为"),s("code",[e._v("ClusterIP")]),e._v("，还有"),s("code",[e._v("ExternalName")]),e._v(",  "),s("code",[e._v("NodePort")]),e._v("，"),s("code",[e._v("LoadBalancer")]),e._v("和"),s("code",[e._v("Headless")]),e._v("，共5种类型")])]),e._v(" "),s("h3",{attrs:{id:"_1-clusterip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-clusterip"}},[e._v("#")]),e._v(" 1.ClusterIP")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/Docker/clusterip.png",alt:"ClusterIP"}})]),e._v(" "),s("p",[e._v("客户端"),s("code",[e._v("Pod")]),e._v("对象访问服务端"),s("code",[e._v("Pod")]),e._v("对象时不会进行源地址转换:")]),e._v(" "),s("ul",[s("li",[e._v("二者在同一主机时，源地址为客户端"),s("code",[e._v("pod")]),e._v("地址；")]),e._v(" "),s("li",[e._v("二者不在同一主机时，源地址为客户端"),s("code",[e._v("pod")]),e._v("所在节点的"),s("code",[e._v("flannel")]),e._v("或"),s("code",[e._v("cni")]),e._v("地址。")])]),e._v(" "),s("blockquote",[s("p",[e._v("只能在集群内部被访问 。")])]),e._v(" "),s("h3",{attrs:{id:"_2-nodeport"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-nodeport"}},[e._v("#")]),e._v(" 2.NodePort")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/Docker/NodePort.png",alt:"NodePort"}})]),e._v(" "),s("p",[e._v("可以被集群外部访问到，节点的请求会"),s("code",[e._v("DNAT")]),e._v("到"),s("code",[e._v("Serviceip")]),e._v("，然后再调度至"),s("code",[e._v("PodIP")])]),e._v(" "),s("h3",{attrs:{id:"_3-loadbalancer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-loadbalancer"}},[e._v("#")]),e._v(" 3.LoadBalancer")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/Docker/externalclients.png",alt:"LoadBalancer"}})]),e._v(" "),s("p",[e._v("需要结合公有云的"),s("code",[e._v("LBAAS")]),e._v("（需要付费），支持动态接入功能。")]),e._v(" "),s("h3",{attrs:{id:"_4-externalname"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-externalname"}},[e._v("#")]),e._v(" 4.ExternalName")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://github-aaron89.oss-cn-beijing.aliyuncs.com/Docker/externalname.png",alt:"ExternalName"}})]),e._v(" "),s("p",[e._v("将集群外部"),s("code",[e._v("Service")]),e._v("引入集群内部供各客户端使用，需要设置标签选择器，并手动定义一个endpoint资源，指向外部的资源地址。")]),e._v(" "),s("h3",{attrs:{id:"_5-headless"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-headless"}},[e._v("#")]),e._v(" 5.Headless")]),e._v(" "),s("p",[e._v("这是一个比较特殊的"),s("code",[e._v("service")]),e._v("类型，有时候，你没必要或者不需要负载均衡和一个对外提供服务的"),s("code",[e._v("ip")]),e._v("地址。在这种情况下，你可以在"),s("code",[e._v(".spec.clusterIp")]),e._v("中定义"),s("code",[e._v("None")]),e._v("字段，来申明一个"),s("code",[e._v("Headless Service")]),e._v("。他可以通过"),s("code",[e._v("coredns")]),e._v("组件内部的解析功能，以完成相关地址解析的支持作用。")]),e._v(" "),s("h2",{attrs:{id:"_3-endpoints"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-endpoints"}},[e._v("#")]),e._v(" 3.Endpoints")]),e._v(" "),s("p",[s("code",[e._v("endpoints")]),e._v("为"),s("code",[e._v("service")]),e._v("中的网络端点，用于接收"),s("code",[e._v("service")]),e._v("发来的请求，并将其转发至相关的上游服务（"),s("code",[e._v("deployment")]),e._v("）。")]),e._v(" "),s("ol",[s("li",[e._v("查看命令")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("kubectl explain endpoints\n    \nkubectl get endpoints -A\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("注意：自定义"),s("code",[e._v("endpoints")]),e._v("时，需要与"),s("code",[e._v("service")]),e._v("同名")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("root@centos-1 chapter5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#  kubectl get svc")]),e._v("\nNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("   AGE\nkubernetes   ClusterIP   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10.96")]),e._v(".0.1       "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("443")]),e._v("/TCP   4d23h\nngx-new      ClusterIP   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10.96")]),e._v(".232.218   "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v("/TCP    2d5h\n    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("root@centos-1 chapter5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# kubectl get endpoints")]),e._v("\nNAME         ENDPOINTS                     AGE\nkubernetes   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("192.168")]),e._v(".0.104:6443            4d23h\nngx-new      "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10.244")]),e._v(".2.8:80,10.244.2.9:80   2d5h\n")])])])])}),[],!1,null,null,null);t.default=v.exports}}]);